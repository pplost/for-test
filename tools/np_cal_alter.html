<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<title>NP计算器</title>
	<link rel="stylesheet" href="../css/trash.css" type="text/css" />
</head>
<body>
	<div id="title_link">
	</div>
	<table>
		<tbody>
			<tr>
				<td>从者</td>
				<td colspan="3" style="text-align:center">
					<select id="servants"></select>
				</td>
				<td>查询</td>
				<td colspan="2">
					<input type="text" id="search_str">
				</td>
				<td><a id="link_to_wiki">点此前往wiki</a></td>
			</tr>
			
			<tr>
				<td>配卡</td>
				<td colspan="7" id="cards"></td>
			</tr>
			
			<tr>
				<td>红卡hit数</td>
				<td><input type="number" id="buster_hits" style="width:50px" disabled></td>
				<td>蓝卡hit数</td>
				<td><input type="number" id="arts_hits" style="width:50px" disabled></td>
				<td>绿卡hit数</td>
				<td><input type="number" id="quick_hits" style="width:50px" disabled></td>
				<td>EX卡hit数</td>
				<td><input type="number" id="ex_hits" style="width:50px" disabled></td>
			</tr>
			
			<tr>
				<td>红卡np率(%)</td>
				<td><input type="number" id="buster_np" style="width:50px" disabled></td>
				<td>蓝卡np率(%)</td>
				<td><input type="number" id="arts_np" style="width:50px" disabled></td>
				<td>绿卡np率(%)</td>
				<td><input type="number" id="quick_np" style="width:50px" disabled></td>
				<td>ex卡np率(%)</td>
				<td><input type="number" id="ex_np" style="width:50px" disabled></td>
			</tr>
			
			<tr>
				<td>骑乘(%)</td>
				<td><input type="number" id="ride" style="width:50px" disabled></td>
				<td>阵地建造(%)</td>
				<td><input type="number" id="craft_build" style="width:50px" disabled></td>
				<td>宝具hit数</td>
				<td><input type="number" id="np_hits" style="width:50px" disabled></td>
				<td>宝具np率(%)</td>
				<td><input type="number" id="np_np" style="width:50px" disabled></td>
			</tr>
			
			<tr>
				<td>一技能</td>
				<td>
					<select id="first_skill"  style="width:65px">
						<option value="0" >0</option>
						<option value="1" >1</option>
						<option value="2" >2</option>
						<option value="3" >3</option>
						<option value="4" >4</option>
						<option value="5" >5</option>
						<option value="6" >6</option>
						<option value="7" >7</option>
						<option value="8" >8</option>
						<option value="9" >9</option>
						<option value="10" >10</option>
					</select>
				</td>
				<td>二技能</td>
				<td>
					<select id="first_skill"  style="width:65px">
						<option value="0" >0</option>
						<option value="1" >1</option>
						<option value="2" >2</option>
						<option value="3" >3</option>
						<option value="4" >4</option>
						<option value="5" >5</option>
						<option value="6" >6</option>
						<option value="7" >7</option>
						<option value="8" >8</option>
						<option value="9" >9</option>
						<option value="10" >10</option>
					</select>
				</td>
				<td>三技能</td>
				<td>
					<select id="first_skill"  style="width:65px">
						<option value="0" >0</option>
						<option value="1" >1</option>
						<option value="2" >2</option>
						<option value="3" >3</option>
						<option value="4" >4</option>
						<option value="5" >5</option>
						<option value="6" >6</option>
						<option value="7" >7</option>
						<option value="8" >8</option>
						<option value="9" >9</option>
						<option value="10" >10</option>
					</select>
				</td>
				<td>宝具OC等级</td>
				<td>
					<select id="first_skill"  style="width:65px">
						<option value="1" >1</option>
						<option value="2" >2</option>
						<option value="3" >3</option>
						<option value="4" >4</option>
						<option value="5" >5</option>
					</select>
				</td>
			</tr>
			
			<tr>
				<td>np获取提升(%)</td>
				<td><input type="number" id="np_up" style="width:50px"></td>
				<td>蓝魔放(%)</td>
				<td><input type="number" id="arts_up" style="width:50px"></td>
				<td>绿魔放(%)</td>
				<td><input type="number" id="quick_up" style="width:50px"></td>
				<td colspan="2"></td>
			</tr>
			
		</tbody>
		
		<tbody id ="skills">
			<tr>
				
			</tr>
		</tbody>
		
		<tbody>
			<tr>
				<td></td>
				<td>首卡</td>
				<td>次卡</td>
				<td>尾卡</td>
				<td>ex卡</td>
				<td colspan="3" rowspan="6" id="cal_result"></td>
			</tr>
			
			<tr>
				<td>是否暴击</td>
				<td><input type="checkbox" id="first_crit" style="width:50px"></td>
				<td><input type="checkbox" id="second_crit" style="width:50px"></td>
				<td><input type="checkbox" id="third_crit" style="width:50px"></td>
				<td colspan="1"></td>
			</tr>

			<tr>
				<td >是否鞭尸</td>
				<td><input type="checkbox" id="first_ok" style="width:50px"></td>
				<td><input type="checkbox" id="second_ok" style="width:50px"></td>
				<td><input type="checkbox" id="third_ok" style="width:50px"></td>
				<td><input type="checkbox" id="ex_ok" style="width:50px"></td>
			</tr>
			
			<tr>
				<td >鞭尸hit数</td>
				<td><input type="number" id="first_ok_hits" style="width:50px"></td>
				<td><input type="number" id="second_ok_hits" style="width:50px"></td>
				<td><input type="number" id="third_ok_hits" style="width:50px"></td>
				<td><input type="number" id="ex_ok_hits" style="width:50px"></td>
			</tr>
			
			<tr>
				<td>卡序</td>
				<td>
					<select id="first_card"  style="width:65px">
						<option value="-1" >无</option>
						<option value="0">Buster</option>
						<option value="3">Arts</option>
						<option value="1">Quick</option>
						<option value="-11">宝具</option>
						<option value="-2">仅染色</option>
					</select>
				</td>
				<td>
					<select id="second_card" style="width:65px">
						<option value="-1">无</option>
						<option value="0">Buster</option>
						<option value="4.5">Arts</option>
						<option value="1.5">Quick</option>
						<option value="-11">宝具</option>
					</select>
				</td>
				<td>
					<select id="third_card" style="width:65px">
						<option value="-1">无</option>
						<option value="0">Buster</option>
						<option value="6">Arts</option>
						<option value="2">Quick</option>
						<option value="-11">宝具</option>
					</select>
				</td>
				<td>
					<select id="ex_card" style="width:65px">
						<option value="-1">无</option>
						<option value="1">EX</option>
					</select>
				</td>
				
			</tr>
			
			<tr>
				<td>敌方补正</td>
				<td>
					<select id="enemy_class">
						<option value="1">其他:1</option>
						<option value="1.1">Rider:1.1</option>
						<option value="1.2">Caster:1.2</option>
						<option value="0.9">Assassin:0.9</option>
						<option value="0.8">Berserker:0.8</option>
						<option value="1.2">MoonCancer:1.2</option>
					</select>
				</td>
				<td>
					<select id="enemy_kind">
						<option value="1">其他 : 1</option>
						<option value="1.2">死灵类 : 1.2</option>
					</select>
				</td>
				<td>
					<input type="button" id="cal_np" onclick="calNP()" value="计算">
				</td>
				<td>
					<input type="button" id="cal_np_list" onclick="calNPList()" value="列表">
				</td>
			</tr>
			
			<tr>
				<td colspan="8">例外：1.死灵类中鐘を鳴らすもの和エレシュキガル的种类补正是1。<br/>2.クリスティーヌ(Assassin)以狂阶补正计算。</td>
			</tr>
			<tr>
				<td colspan="8" style="text-align:right; font-size:12px; border:1px solid #fff;"><a href="https://xianlechuanshuo.github.io/fgo/calc4.html">友情链接：宝具计算器</a></td>
			</tr>
		</tbody>
	</table>
	<p></p>
	<table id="np_list"></table>
	
	<script type="text/javascript" src="../js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="../js/title-link.js"></script>
	<script type="text/javascript">
		var servants = new Array();
		//读取数据
		$(function(){  
			$.getJSON("https://pplost.github.io/for-test/data/servants.json",function(data){  
				$.each(data,function(infoIndex,info){
					servants[info["seq"]]=info;
					let lst='<option value="'+servants[info["seq"]].seq+'">'+'【'+servants[info["seq"]]["class"]+"】 "+servants[info["seq"]].name+'</option>';
					$("#servants").append(lst);
				});
				$("#servants").val(1); 
				updateStatus(1);
			});
		});
		
		//选择下拉框事件
		$("#servants").change(function(){
			let seq=$("#servants").val();
			updateStatus(seq);
		});
		
		//更新表格数据
		function updateStatus(seq){
			$("#buster_hits").val(servants[seq].busterHits);
			$("#arts_hits").val(servants[seq].artsHits);
			$("#quick_hits").val(servants[seq].quickHits);
			$("#ex_hits").val(servants[seq].exHits);
			$("#buster_np").val(servants[seq].busterNP);
			$("#arts_np").val(servants[seq].artsNP);
			$("#quick_np").val(servants[seq].quickNP);
			$("#ex_np").val(servants[seq].exNP);
			$("#ride").val(servants[seq].quickEff);
			$("#craft_build").val(servants[seq].artsEff);
			$("#np_np").val(servants[seq].npNP);
			$("#np_hits").val(servants[seq].npHits);
			$("#cards").empty();
			if(servants[seq].npCard=="Buster"){
				let card='<img src="resources/others/Buster.png" style="width:81px">';
				$("#cards").append(card);
			}
			else if(servants[seq].npCard=="Arts"){
				let card='<img src="resources/others/Arts.png" style="width:81px">';
				$("#cards").append(card);
			}
			else if(servants[seq].npCard=="Quick"){
				let card='<img src="resources/others/Quick.png" style="width:81px">';
				$("#cards").append(card);
			}
			for(let i=0;i<servants[seq].busterCards;i++){
				let card='<img src="resources/others/Buster.png" style="width:50px">';
				$("#cards").append(card);
			}
			for(let i=0;i<servants[seq].artsCards;i++){
				let card='<img src="resources/others/Arts.png" style="width:50px">';
				$("#cards").append(card);
			}
			for(let i=0;i<servants[seq].quickCards;i++){
				let card='<img src="resources/others/Quick.png" style="width:50px">';
				$("#cards").append(card);
			}
			$("#link_to_wiki").attr("href",'http://fgowiki.com/guide/petdetail/'+servants[seq].id);
		}
	
	
	
	
	
	
	
	
	
	
	
	
		
		//基本NP獲得率(Atk) × [首卡加成 + 卡片倍率 x (1 ± 卡片性能Buff)] × (1 + NP獲得量Buff)× Critical補正 × Overkill補正 × 攻擊Hit數 × 伺服器控制參數(假設為1)

		//首卡加成
		//若第一張卡是Arts卡的話為1，其餘為0，寶具卡不受此加成

		//Critical補正
		//有Critical的話為2倍

		//Overkill補正
		//有Overkill的話為1.5倍

		//卡片倍率
		//Extra卡為1，寶具卡視為各顏色第1張

		//倍率	Arts    Buster      Quick
		//第1張	3	    0           1
		//第2張	4.5	    0	        1.5
		//第3張	6	    0	        2

	</script>
</body>
</html>