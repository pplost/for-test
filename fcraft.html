<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<title>羁绊礼装表</title>
	<link rel="stylesheet" href="css/trash.css" type="text/css" />
	<style type="text/css">
	body {
		background-color:#fff0cd;
	}
	a { 
		text-decoration:none;
		color:#000;
	}
	table th.clickable {
		cursor: pointer;
	}
	</style>
</head>
<body>
	<table id="cftable">
	</table>
	<p style="text-align:right; font-size:12px;"><a href="http://kazemai.github.io/fgo-vz/">数据来源：茹西教王的理想乡</a></p>
	<p style="text-align:right; font-size:12px;"><a href="http://bbs.nga.cn/read.php?tid=11177929">数据来源：地球联邦4@NGA</a></p>
	<p style="text-align:right; font-size:12px;"><a href="http://bbs.nga.cn/read.php?tid=11961759">校对：进击的黄瓜2@NGA</a></p>
</body>
</html>

<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
<script type="text/javascript">
	var info = new Array();
	$(function(){  
		$.getJSON("https://pplost.github.io/for-test/data/fcraft.json",function(data){
			for (var i in data){
				var row = {
					id:data[i].id,
					name:data[i].name,
					servantID:data[i].servantID,
					servant:data[i].servant,
					desc:data[i].desc
				};
				for(var j in data[i]["friendship"]){
					row[j]=data[i]["friendship"][j];
				}
				info.push(row);
			};
			createTable();
		});
		
	})
	
	function createTable(){
		$("#cftable").empty();
		createTableHead();
		var line = 1;
		for(var i in info){
			var sty=""
			if((line % 2) == 1){
				sty=' class="odd"';
			}
			var clink = 'href="http://fgowiki.com/guide/equipdetail/' + info[i]["id"] + '"';
			var slink = 'href="http://fgowiki.com/guide/petdetail/' + info[i]["servantID"] + '"';
			var tr = $('<tr' + sty + '></tr>');
			var tds = '<td><a ' + clink + ' target="_blank">' + info[i]["id"] + '</a></td>';
			tds += '<td><a ' + clink + ' target="_blank"><img src="http://fgowiki.com/fgo/equip/' + info[i]["id"] + '.jpg" style="width:60px ;height:auto"></a></td>';
			tds += '<td><a ' + clink + ' target="_blank">' + info[i]["name"] + '</a></td>';
			tds += '<td><a ' + slink + ' target="_blank">' + info[i]["servant"] + '</a></td>';
			tds += '<td><a ' + slink + ' target="_blank"><img src="http://file.fgowiki.fgowiki.com/fgo/head/' + (Array(3).join('0') + info[i]["servantID"]).slice(-3) + '.jpg" style="width:60px ;height:auto"></a></td>';
			tds += '<td>' + info[i]["0-5"] + '</td>';
			tds += '<td>' + info[i]["5-6"] + '</td>';
			tds += '<td>' + info[i]["6-7"] + '</td>';
			tds += '<td>' + info[i]["7-8"] + '</td>';
			tds += '<td>' + info[i]["8-9"] + '</td>';
			tds += '<td>' + info[i]["9-10"] + '</td>';
			tds += '<td>' + info[i]["total"] + '</td>';
			tds += '<td style="text-align:left">' + info[i]["desc"] + '</td>';
			tr.append(tds);
			$("#cftable").append(tr);
			line++;
		}
	}
	
	function createTableHead(){
		var tr1 = $('<tr></tr>');
		var tr2 = $('<tr></tr>');
		var ths = '<th id="thID" rowspan="2" class="clickable" onclick="sortTable(\'id\')">ID</th>';
		ths += '<th rowspan="2" class="clickable" onclick="sortTable(\'id\')">图标</th>';
		ths += '<th rowspan="2" class="clickable" onclick="sortTable(\'name\')">名称</th>';
		ths += '<th rowspan="2" class="clickable" onclick="sortTable(\'servant\')">隶属从者</th>';
		ths += '<th rowspan="2" class="clickable" onclick="sortTable(\'servantID\')">头像</th>';
		ths += '<th colspan="7">羁绊点数(万)</th>';
		ths += '<th rowspan="2">说明</th>';
		tr1.append(ths);
		$("#cftable").append(tr1);
		ths = '<th class="clickable" onclick="sortTable(4)">0-5</th>';
		ths += '<th class="clickable" onclick="sortTable(5)">5-6</th>';
		ths += '<th class="clickable" onclick="sortTable(6)">6-7</th>';
		ths += '<th class="clickable" onclick="sortTable(7)">7-8</th>';
		ths += '<th class="clickable" onclick="sortTable(8)">8-9</th>';
		ths += '<th class="clickable" onclick="sortTable(9)">9-10</th>';
		ths += '<th class="clickable" onclick="sortTable(10)">总计</th>';
		tr2.append(ths);
		$("#cftable").append(tr2);
	}
	
	function sortTable(col){
		console.log(col);
		var v1;
		var v2;
		var type="desc";
		for(var i in info){
			if(i==0){
				v1=info[i][col];
				v2=info[i][col];
			}
			else{
				v1=info[i][col];
				if(v1>v2){
					type="asc";
					break;
				}
				else if(v1<v2){
					type="desc";
					break;
				}
				v2=info[i][col];
			}
		}
		if(type=="asc"){
			info.sort(function(x, y){
				//return y[col]-x[col];
				return y[col].localeCompare(x[col])
			});
		}
		else{
			info.sort(function(x, y){
				return x[col].localeCompare(y[col])
			});
		}
		createTable();
	}
	
</script>  


